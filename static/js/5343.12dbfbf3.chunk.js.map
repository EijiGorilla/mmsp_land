{"version":3,"file":"static/js/5343.12dbfbf3.chunk.js","mappings":"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","sources":["components/IsfChart.tsx"],"sourcesContent":["import { useRef, useState, useEffect, memo } from 'react';\r\nimport { isfLayer } from '../layers';\r\nimport { view } from '../Scene';\r\nimport FeatureFilter from '@arcgis/core/layers/support/FeatureFilter';\r\nimport Query from '@arcgis/core/rest/support/Query';\r\nimport * as am5 from '@amcharts/amcharts5';\r\nimport * as am5percent from '@amcharts/amcharts5/percent';\r\nimport am5themes_Animated from '@amcharts/amcharts5/themes/Animated';\r\nimport am5themes_Responsive from '@amcharts/amcharts5/themes/Responsive';\r\nimport { generateIsfData, generateIsfNumber, thousands_separators } from '../Query';\r\nimport { CalciteLabel } from '@esri/calcite-components-react';\r\n\r\n// Dispose function\r\nfunction maybeDisposeRoot(divId: any) {\r\n  am5.array.each(am5.registry.rootElements, function (root) {\r\n    if (root.dom.id === divId) {\r\n      root.dispose();\r\n    }\r\n  });\r\n}\r\n\r\n///*** Others */\r\n\r\n/// Draw chart\r\nconst IsfChart = memo(({ contractp, landtype, landsection }: any) => {\r\n  const pieSeriesRef = useRef<unknown | any | undefined>({});\r\n  const legendRef = useRef<unknown | any | undefined>({});\r\n  const chartRef = useRef<unknown | any | undefined>({});\r\n  const [isfData, SetIsfData] = useState([\r\n    {\r\n      category: String,\r\n      value: Number,\r\n      sliceSettings: {\r\n        fill: am5.color('#00c5ff'),\r\n      },\r\n    },\r\n  ]);\r\n  const [isfNumber, setIsfNumber] = useState();\r\n\r\n  const chartID = 'isf-pie';\r\n\r\n  // Query\r\n  const qCP = \"Package = '\" + contractp + \"'\";\r\n  const qLandType = \"Type = '\" + landtype + \"'\";\r\n  const qCpLandType = qCP + ' AND ' + qLandType;\r\n  const qLandSection = \"Station1 ='\" + landsection + \"'\";\r\n  const qCpLandTypeSection = qCpLandType + ' AND ' + qLandSection;\r\n\r\n  if (!contractp) {\r\n    isfLayer.definitionExpression = '1=1';\r\n  } else if (contractp && !landtype && !landsection) {\r\n    isfLayer.definitionExpression = qCP;\r\n  } else if (contractp && landtype && !landsection) {\r\n    isfLayer.definitionExpression = qCpLandType;\r\n  } else {\r\n    isfLayer.definitionExpression = qCpLandTypeSection;\r\n  }\r\n\r\n  useEffect(() => {\r\n    generateIsfData(contractp, landtype, landsection).then((result: any) => {\r\n      SetIsfData(result);\r\n    });\r\n\r\n    // ISF\r\n    generateIsfNumber().then((response: any) => {\r\n      setIsfNumber(response);\r\n    });\r\n  }, [contractp, landtype, landsection]);\r\n\r\n  useEffect(() => {\r\n    // Dispose previously created root element\r\n\r\n    maybeDisposeRoot(chartID);\r\n\r\n    var root = am5.Root.new(chartID);\r\n    root.container.children.clear();\r\n    root._logo?.dispose();\r\n\r\n    // Set themesf\r\n    // https://www.amcharts.com/docs/v5/concepts/themes/\r\n    root.setThemes([am5themes_Animated.new(root), am5themes_Responsive.new(root)]);\r\n\r\n    // Create chart\r\n    // https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/\r\n    var chart = root.container.children.push(\r\n      am5percent.PieChart.new(root, {\r\n        layout: root.verticalLayout,\r\n      }),\r\n    );\r\n    chartRef.current = chart;\r\n\r\n    // Create series\r\n    // https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/#Series\r\n    var pieSeries = chart.series.push(\r\n      am5percent.PieSeries.new(root, {\r\n        name: 'Series',\r\n        categoryField: 'category',\r\n        valueField: 'value',\r\n        //legendLabelText: \"[{fill}]{category}[/]\",\r\n        legendValueText: \"{valuePercentTotal.formatNumber('#.')}% ({value})\",\r\n        radius: am5.percent(45), // outer radius\r\n        innerRadius: am5.percent(28),\r\n        scale: 2,\r\n      }),\r\n    );\r\n    pieSeriesRef.current = pieSeries;\r\n    chart.series.push(pieSeries);\r\n\r\n    // values inside a donut\r\n    let inner_label = pieSeries.children.push(\r\n      am5.Label.new(root, {\r\n        text: '[#ffffff]{valueSum}[/]\\n[fontSize: 7px; #d3d3d3; verticalAlign: super]FAMILIES[/]',\r\n        fontSize: 15,\r\n        centerX: am5.percent(50),\r\n        centerY: am5.percent(40),\r\n        populateText: true,\r\n        oversizedBehavior: 'fit',\r\n        textAlign: 'center',\r\n      }),\r\n    );\r\n\r\n    pieSeries.onPrivate('width', (width: any) => {\r\n      inner_label.set('maxWidth', width * 0.7);\r\n    });\r\n\r\n    // Set slice opacity and stroke color\r\n    pieSeries.slices.template.setAll({\r\n      fillOpacity: 0.9,\r\n      stroke: am5.color('#ffffff'),\r\n      strokeWidth: 0.5,\r\n      strokeOpacity: 1,\r\n      templateField: 'sliceSettings',\r\n    });\r\n\r\n    // Disabling labels and ticksll\r\n    pieSeries.labels.template.set('visible', false);\r\n    pieSeries.ticks.template.set('visible', false);\r\n\r\n    // EventDispatcher is disposed at SpriteEventDispatcher...\r\n    // It looks like this error results from clicking events\r\n    pieSeries.slices.template.events.on('click', (ev) => {\r\n      const selected: any = ev.target.dataItem?.dataContext;\r\n      const categorySelect: string = selected.category;\r\n\r\n      var highlightSelect: any;\r\n\r\n      var query = isfLayer.createQuery();\r\n\r\n      view.when(function () {\r\n        view.whenLayerView(isfLayer).then((layerView): any => {\r\n          //chartLayerView = layerView;\r\n\r\n          isfLayer.queryFeatures(query).then(function (results) {\r\n            const RESULT_LENGTH = results.features;\r\n            const ROW_N = RESULT_LENGTH.length;\r\n\r\n            let objID = [];\r\n            for (var i = 0; i < ROW_N; i++) {\r\n              var obj = results.features[i].attributes.OBJECTID;\r\n              objID.push(obj);\r\n            }\r\n\r\n            var queryExt = new Query({\r\n              objectIds: objID,\r\n            });\r\n\r\n            isfLayer.queryExtent(queryExt).then(function (result) {\r\n              if (result.extent) {\r\n                view.goTo(result.extent);\r\n              }\r\n            });\r\n\r\n            if (highlightSelect) {\r\n              highlightSelect.remove();\r\n            }\r\n            highlightSelect = layerView.highlight(objID);\r\n\r\n            view.on('click', function () {\r\n              layerView.filter = new FeatureFilter({\r\n                where: undefined,\r\n              });\r\n              highlightSelect.remove();\r\n            });\r\n          }); // End of queryFeatures\r\n\r\n          layerView.filter = new FeatureFilter({\r\n            where: \"RELOCATION = '\" + categorySelect + \"'\",\r\n          });\r\n        }); // End of view.whenLayerView\r\n      }); // End of view.whenv\r\n    });\r\n\r\n    pieSeries.data.setAll(isfData);\r\n\r\n    // Legend\r\n    // https://www.amcharts.com/docs/v5/charts/percent-charts/legend-percent-series/\r\n    var legend = chart.children.push(\r\n      am5.Legend.new(root, {\r\n        centerX: am5.percent(50),\r\n        x: am5.percent(50),\r\n      }),\r\n    );\r\n    legendRef.current = legend;\r\n    legend.data.setAll(pieSeries.dataItems);\r\n\r\n    // Change the size of legend markers\r\n    legend.markers.template.setAll({\r\n      width: 18,\r\n      height: 18,\r\n    });\r\n\r\n    // Change the marker shape\r\n    legend.markerRectangles.template.setAll({\r\n      cornerRadiusTL: 10,\r\n      cornerRadiusTR: 10,\r\n      cornerRadiusBL: 10,\r\n      cornerRadiusBR: 10,\r\n    });\r\n\r\n    // Responsive legend\r\n    // https://www.amcharts.com/docs/v5/tutorials/pie-chart-with-a-legend-with-dynamically-sized-labels/\r\n    // This aligns Legend to Left\r\n    chart.onPrivate('width', function (width: any) {\r\n      const boxWidth = 190; //props.style.width;\r\n      var availableSpace = Math.max(width - chart.height() - boxWidth, boxWidth);\r\n      //var availableSpace = (boxWidth - valueLabelsWidth) * 0.7\r\n      legend.labels.template.setAll({\r\n        width: availableSpace,\r\n        maxWidth: availableSpace,\r\n      });\r\n    });\r\n\r\n    // To align legend items: valueLabels right, labels to left\r\n    // 1. fix width of valueLabels\r\n    // 2. dynamically change width of labels by screen size\r\n\r\n    const valueLabelsWidth = 50;\r\n\r\n    // Change legend labelling properties\r\n    // To have responsive font size, do not set font size\r\n    legend.labels.template.setAll({\r\n      oversizedBehavior: 'truncate',\r\n      fill: am5.color('#ffffff'),\r\n      //textDecoration: \"underline\"\r\n      //width: am5.percent(200)\r\n      //fontWeight: \"300\"\r\n    });\r\n\r\n    legend.valueLabels.template.setAll({\r\n      textAlign: 'right',\r\n      width: valueLabelsWidth,\r\n      fill: am5.color('#ffffff'),\r\n      //fontSize: LEGEND_FONT_SIZE,\r\n    });\r\n\r\n    legend.itemContainers.template.setAll({\r\n      // set space between legend items\r\n      paddingTop: 5,\r\n      paddingBottom: 1,\r\n    });\r\n\r\n    pieSeries.appear(1000, 100);\r\n\r\n    return () => {\r\n      root.dispose();\r\n    };\r\n  }, [chartID, isfData]);\r\n\r\n  useEffect(() => {\r\n    pieSeriesRef.current?.data.setAll(isfData);\r\n    legendRef.current?.data.setAll(pieSeriesRef.current.dataItems);\r\n  });\r\n\r\n  return (\r\n    <>\r\n      <CalciteLabel>TOTAL ISF</CalciteLabel>\r\n      <CalciteLabel layout=\"inline\">\r\n        <b className=\"isfTotalNumber\">\r\n          {thousands_separators(isfNumber)}\r\n\r\n          <img\r\n            src=\"https://EijiGorilla.github.io/Symbols/NLO_Logo.svg\"\r\n            alt=\"NLO Logo\"\r\n            height={'60%'}\r\n            width={'60%'}\r\n            style={{ marginLeft: '250%', display: 'flex', marginTop: '-35%' }}\r\n          />\r\n        </b>\r\n      </CalciteLabel>\r\n\r\n      <div\r\n        id={chartID}\r\n        style={{\r\n          height: '35vh',\r\n          backgroundColor: 'rgb(0,0,0,0)',\r\n          color: 'white',\r\n        }}\r\n      ></div>\r\n    </>\r\n  );\r\n}); // End of lotChartgs\r\n\r\nexport default IsfChart;\r\n"],"names":["memo","_ref","contractp","landtype","landsection","pieSeriesRef","useRef","legendRef","chartRef","isfData","SetIsfData","useState","category","String","value","Number","sliceSettings","fill","am5","isfNumber","setIsfNumber","chartID","qCP","qCpLandType","qCpLandTypeSection","isfLayer","definitionExpression","useEffect","generateIsfData","then","result","generateIsfNumber","response","_root$_logo","divId","rootElements","root","dom","id","dispose","new","container","children","clear","_logo","setThemes","am5themes_Animated","am5themes_Responsive","chart","push","am5percent","layout","verticalLayout","current","pieSeries","series","name","categoryField","valueField","legendValueText","radius","innerRadius","scale","inner_label","text","fontSize","centerX","centerY","populateText","oversizedBehavior","textAlign","onPrivate","width","set","slices","template","setAll","fillOpacity","stroke","strokeWidth","strokeOpacity","templateField","labels","ticks","events","on","ev","_ev$target$dataItem","categorySelect","target","dataItem","dataContext","highlightSelect","query","createQuery","view","when","whenLayerView","layerView","queryFeatures","results","ROW_N","features","length","objID","i","obj","attributes","OBJECTID","queryExt","Query","objectIds","queryExtent","extent","goTo","remove","highlight","filter","FeatureFilter","where","undefined","data","legend","x","dataItems","markers","height","markerRectangles","cornerRadiusTL","cornerRadiusTR","cornerRadiusBL","cornerRadiusBR","availableSpace","Math","max","maxWidth","valueLabels","itemContainers","paddingTop","paddingBottom","appear","_pieSeriesRef$current","_legendRef$current","_jsxs","_Fragment","_jsx","CalciteLabel","className","thousands_separators","src","alt","style","marginLeft","display","marginTop","backgroundColor","color"],"sourceRoot":""}